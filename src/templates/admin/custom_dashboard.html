{% extends 'admin/master.html' %}

{% block body %}
  <h1>Custom Dashboard</h1>
  <p>Welcome to your custom dashboard. Here you can monitor the status of your application.</p>

  <hr>

  <h2>Recent Analyses</h2>
  {% if recent_analyses %}
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Channel</th>
                <th>Token</th>
                <th>Hype Score</th>
                <th>Analysis Time</th>
            </tr>
        </thead>
        <tbody>
            {% for fav in recent_analyses %}
            <tr>
                <td>{{ fav.channel }}</td>
                <td>{{ fav.ticker or 'N/A' }}</td>
                <td>{{ fav.hype_score or 'N/A' }}</td>
                <td>{{ fav.last_analysis_timestamp.strftime('%Y-%m-%d %H:%M:%S') if fav.last_analysis_timestamp else 'N/A' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
  {% else %}
    <p>No analyses have been performed yet.</p>
  {% endif %}

  <hr>

  <h2>Background Task Logs</h2>
  <pre style="background-color: #f5f5f5; border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll;">
    <code>{{ task_logs }}</code>
  </pre>

  <hr>

  <h2>Manual Actions</h2>
  <a href="{{ url_for('custom.trigger_task') }}" class="btn btn-primary">Trigger Message Check</a>
  <p class="text-muted">Click the button above to manually trigger the Celery task to check for new Telegram messages.</p>

{% endblock %}
